version: 1
frontend:
  phases:
    preBuild:
      commands:
        - nvm use 20
        - echo "Node version:" && node --version
        - echo "NPM version:" && npm --version
        - echo "Checking environment variables..."
        - echo "EMAIL_USER is set:" $(if [ -n "$EMAIL_USER" ]; then echo "YES"; else echo "NO"; fi)
        - echo "EMAIL_PASSWORD is set:" $(if [ -n "$EMAIL_PASSWORD" ]; then echo "YES"; else echo "NO"; fi)
        - echo "CLERK_SECRET_KEY is set:" $(if [ -n "$CLERK_SECRET_KEY" ]; then echo "YES"; else echo "NO"; fi)
        - echo "NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY is set:" $(if [ -n "$NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY" ]; then echo "YES"; else echo "NO"; fi)
        - echo "NEXT_PUBLIC_BACKEND_URL is set:" $(if [ -n "$NEXT_PUBLIC_BACKEND_URL" ]; then echo "YES"; else echo "NO"; fi)
        - npm ci
    build:
      commands:
        - echo "Starting build process..."
        - npm run build
        - echo "Build completed successfully"
  artifacts:
    baseDirectory: .next
    files:
      - '**/*'
  cache:
    paths:
      - node_modules/**/*
      - .next/cache/**/* 